<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Fake Call - Incoming Call Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            background: #000;
            color: #fff;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            transition: background 0.5s ease;
        }
        
        body.screen-off {
            background: #000 !important;
        }
        
        body.screen-off .screen-off-overlay {
            display: flex !important;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            text-align: center;
            transition: opacity 0.5s ease;
        }
        
        body.screen-off .container {
            opacity: 0;
        }
        
        .header {
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .header p {
            color: #a0a0c0;
            font-size: 0.95rem;
        }
        
        .call-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .call-info {
            margin-bottom: 25px;
        }
        
        .caller-photo {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin: 0 auto 20px;
            overflow: hidden;
            border: 4px solid rgba(79, 172, 254, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .caller-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .caller-name {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .call-status {
            font-size: 1.1rem;
            color: #a0a0c0;
            margin-bottom: 10px;
        }
        
        .call-timer {
            font-size: 1.3rem;
            font-weight: 500;
            color: #4facfe;
            display: none;
        }
        
        .call-controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 25px;
        }
        
        .call-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            color: white;
        }
        
        .accept-btn {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            box-shadow: 0 5px 15px rgba(0, 176, 155, 0.3);
        }
        
        .decline-btn {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3);
        }
        
        .end-btn {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3);
            display: none;
            width: 100px;
            height: 100px;
            font-size: 2.5rem;
        }
        
        .call-btn:hover, .call-btn:active {
            transform: scale(0.95);
        }
        
        .setup-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
        }
        
        .setup-panel h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #4facfe;
        }
        
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #a0a0c0;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            -webkit-appearance: none;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        select.form-control {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234facfe' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        .schedule-btn {
            background: linear-gradient(135deg, #8a2be2, #4a00e0);
            color: white;
            border: none;
            padding: 16px 25px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            -webkit-appearance: none;
        }
        
        .schedule-btn:active {
            transform: scale(0.98);
        }
        
        .scheduled-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            display: none;
        }
        
        .instructions {
            margin-top: 20px;
            font-size: 0.8rem;
            color: #a0a0c0;
            line-height: 1.4;
            padding: 0 10px;
        }
        
        .ringing-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(79, 172, 254, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 172, 254, 0); }
        }
        
        /* Screen Off Simulation */
        .screen-off-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: #666;
        }
        
        .screen-off-time {
            font-size: 3.5rem;
            font-weight: 300;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .screen-off-date {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #888;
        }
        
        .screen-off-notification {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            width: 90%;
            max-width: 350px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }
        
        .screen-off-notification-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .screen-off-notification-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .screen-off-notification-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .screen-off-notification-body {
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .tap-to-wake {
            position: absolute;
            bottom: 30px;
            color: #666;
            font-size: 0.9rem;
            animation: fadeInOut 2s infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* Wake Screen Button */
        .wake-screen-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            margin-top: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Control Panel */
        .control-panel {
            position: fixed;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        /* Alert Styles */
        .alert {
            background: rgba(255, 65, 108, 0.1);
            border: 1px solid rgba(255, 65, 108, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .call-container {
                padding: 15px;
                border-radius: 20px;
            }
            
            .caller-photo {
                width: 120px;
                height: 120px;
            }
            
            .caller-name {
                font-size: 1.6rem;
            }
            
            .call-btn {
                width: 70px;
                height: 70px;
                font-size: 1.7rem;
            }
            
            .end-btn {
                width: 85px;
                height: 85px;
                font-size: 2rem;
            }
            
            .call-controls {
                gap: 25px;
            }
            
            .setup-panel {
                padding: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .caller-photo {
                width: 110px;
                height: 110px;
            }
            
            .caller-name {
                font-size: 1.5rem;
            }
            
            .call-btn {
                width: 65px;
                height: 65px;
                font-size: 1.5rem;
            }
            
            .end-btn {
                width: 80px;
                height: 80px;
                font-size: 1.8rem;
            }
            
            .call-controls {
                gap: 20px;
            }
            
            .form-control, .schedule-btn {
                padding: 14px;
            }
        }
        
        /* Prevent text selection */
        .noselect {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="noselect">
    <!-- Screen Off Simulation Overlay -->
    <div class="screen-off-overlay" id="screenOffOverlay">
        <div class="screen-off-time" id="screenOffTime">12:00</div>
        <div class="screen-off-date" id="screenOffDate">Monday, January 1</div>
        
        <div class="screen-off-notification" id="screenOffNotification">
            <div class="screen-off-notification-header">
                <div class="screen-off-notification-icon">
                    <i class="fas fa-phone-alt"></i>
                </div>
                <div>
                    <div class="screen-off-notification-title" id="notificationTitle">Incoming Call</div>
                    <div class="screen-off-notification-body" id="notificationBody">Tap to view</div>
                </div>
            </div>
        </div>
        
        <div class="tap-to-wake">Tap screen to wake</div>
    </div>
    
    <!-- Control Panel -->
    <div class="control-panel">
        <button class="control-btn" id="screenOffBtn" title="Simulate Screen Off">
            <i class="fas fa-power-off"></i>
        </button>
        <button class="control-btn" id="fullscreenBtn" title="Toggle Fullscreen">
            <i class="fas fa-expand"></i>
        </button>
    </div>
    
    <div class="container">
        <div class="alert">
            <i class="fas fa-info-circle"></i> 
            <strong>Important:</strong> This is a simulation. Real phone screens cannot be controlled by web apps due to security restrictions.
        </div>
        
        <div class="header">
            <h1><i class="fas fa-phone-alt"></i> Fake Call</h1>
            <p>Simulate an incoming call with screen-off simulation</p>
        </div>
        
        <div class="call-container">
            <div class="call-info">
                <div class="caller-photo" id="callerPhoto">
                    <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80" alt="Caller Photo" id="photoImg">
                </div>
                <h2 class="caller-name" id="callerName">John Smith</h2>
                <div class="call-status" id="callStatus">Ready for fake call</div>
                <div class="call-timer" id="callTimer">00:00</div>
            </div>
            
            <div class="call-controls">
                <button class="call-btn accept-btn" id="acceptBtn">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="call-btn decline-btn" id="declineBtn">
                    <i class="fas fa-phone-slash"></i>
                </button>
                <button class="call-btn end-btn" id="endBtn">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
        
        <div class="setup-panel">
            <h3><i class="fas fa-cogs"></i> Customize Your Call</h3>
            
            <div class="form-group">
                <label for="callerNameInput"><i class="fas fa-user"></i> Caller Name</label>
                <input type="text" id="callerNameInput" class="form-control" value="John Smith" placeholder="Enter caller name">
            </div>
            
            <div class="form-group">
                <label for="callerPhotoSelect"><i class="fas fa-image"></i> Caller Photo</label>
                <select id="callerPhotoSelect" class="form-control">
                    <option value="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">Business Person</option>
                    <option value="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">Woman Smiling</option>
                    <option value="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">Man with Glasses</option>
                    <option value="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80">Woman at Desk</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="callType"><i class="fas fa-phone"></i> Call Type</label>
                <select id="callType" class="form-control">
                    <option value="normal">Normal Call</option>
                    <option value="emergency">Emergency Call</option>
                    <option value="boss">Boss Calling</option>
                    <option value="friend">Friend Calling</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="delayTime"><i class="fas fa-clock"></i> Schedule Call (seconds)</label>
                <input type="range" id="delayTime" class="form-control" min="5" max="60" value="10">
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span>5s</span>
                    <span id="delayValue">10s</span>
                    <span>60s</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="simulateScreenOff" checked> Simulate screen-off effect
                </label>
            </div>
            
            <button class="schedule-btn" id="scheduleBtn">
                <i class="fas fa-play-circle"></i> Start Fake Call with Screen-Off Simulation
            </button>
            
            <button class="wake-screen-btn" id="wakeScreenBtn">
                <i class="fas fa-bell"></i> Test Wake Notification
            </button>
            
            <div class="scheduled-info" id="scheduledInfo">
                <i class="fas fa-clock"></i> Fake call scheduled in <span id="countdown">10</span> seconds
            </div>
        </div>
        
        <div class="instructions">
            <p><i class="fas fa-lightbulb"></i> <strong>How it works:</strong> Set up your call, then use the power button to simulate screen off. When the call comes, you'll see a notification on the "sleeping" screen. Tap to "wake" and answer.</p>
        </div>
    </div>

    <audio id="ringtoneAudio" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-classic-phone-ring-449.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="notificationSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="callConnectedAudio">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-phone-call-connected-1066.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="callEndedAudio">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-hanging-up-on-a-call-485.mp3" type="audio/mpeg">
    </audio>

    <script>
        // DOM Elements
        const acceptBtn = document.getElementById('acceptBtn');
        const declineBtn = document.getElementById('declineBtn');
        const endBtn = document.getElementById('endBtn');
        const scheduleBtn = document.getElementById('scheduleBtn');
        const callerName = document.getElementById('callerName');
        const callStatus = document.getElementById('callStatus');
        const callTimer = document.getElementById('callTimer');
        const callerPhoto = document.getElementById('callerPhoto');
        const photoImg = document.getElementById('photoImg');
        const callerNameInput = document.getElementById('callerNameInput');
        const callerPhotoSelect = document.getElementById('callerPhotoSelect');
        const delayTime = document.getElementById('delayTime');
        const delayValue = document.getElementById('delayValue');
        const scheduledInfo = document.getElementById('scheduledInfo');
        const countdown = document.getElementById('countdown');
        const screenOffBtn = document.getElementById('screenOffBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const screenOffOverlay = document.getElementById('screenOffOverlay');
        const screenOffTime = document.getElementById('screenOffTime');
        const screenOffDate = document.getElementById('screenOffDate');
        const screenOffNotification = document.getElementById('screenOffNotification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationBody = document.getElementById('notificationBody');
        const wakeScreenBtn = document.getElementById('wakeScreenBtn');
        const callType = document.getElementById('callType');
        const simulateScreenOffCheckbox = document.getElementById('simulateScreenOff');
        
        // Audio elements
        const ringtoneAudio = document.getElementById('ringtoneAudio');
        const notificationSound = document.getElementById('notificationSound');
        const callConnectedAudio = document.getElementById('callConnectedAudio');
        const callEndedAudio = document.getElementById('callEndedAudio');
        
        // State variables
        let callActive = false;
        let callAnswered = false;
        let screenOff = false;
        let callTimerInterval;
        let seconds = 0;
        let minutes = 0;
        let scheduledTimeout;
        let countdownInterval;
        let screenOffTimeout;
        
        // Initialize time display
        function updateTimeDisplay() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateString = now.toLocaleDateString([], {weekday: 'long', month: 'long', day: 'numeric'});
            
            screenOffTime.textContent = timeString;
            screenOffDate.textContent = dateString;
        }
        
        // Update time every minute
        setInterval(updateTimeDisplay, 60000);
        updateTimeDisplay();
        
        // Toggle screen off simulation
        screenOffBtn.addEventListener('click', function() {
            screenOff = !screenOff;
            
            if (screenOff) {
                document.body.classList.add('screen-off');
                screenOffBtn.innerHTML = '<i class="fas fa-power-on"></i>';
                screenOffBtn.title = 'Turn Screen On';
                
                // Show notification after a delay if call is scheduled
                if (scheduledTimeout) {
                    setTimeout(showWakeNotification, 2000);
                }
            } else {
                document.body.classList.remove('screen-off');
                screenOffBtn.innerHTML = '<i class="fas fa-power-off"></i>';
                screenOffBtn.title = 'Simulate Screen Off';
                hideWakeNotification();
            }
        });
        
        // Wake screen when tapping on screen off overlay
        screenOffOverlay.addEventListener('click', function(e) {
            if (screenOff && e.target.closest('.screen-off-notification')) {
                // If tapping on notification, wake screen immediately
                wakeScreen();
                if (callActive) {
                    // If call is active, show it immediately
                    showIncomingCall();
                }
            } else if (screenOff) {
                // If tapping anywhere else, just wake screen
                wakeScreen();
            }
        });
        
        // Test wake notification
        wakeScreenBtn.addEventListener('click', function() {
            if (!screenOff) {
                // First turn screen off
                screenOff = true;
                document.body.classList.add('screen-off');
                screenOffBtn.innerHTML = '<i class="fas fa-power-on"></i>';
                
                setTimeout(() => {
                    showWakeNotification();
                }, 1000);
            } else {
                showWakeNotification();
            }
        });
        
        // Show wake notification
        function showWakeNotification() {
            if (!screenOff) return;
            
            notificationTitle.textContent = "Incoming Call";
            notificationBody.textContent = `${callerNameInput.value || "Unknown"} is calling...`;
            
            // Play notification sound
            notificationSound.play().catch(e => console.log("Audio play failed:", e));
            
            // Show notification with animation
            screenOffNotification.style.display = 'block';
            
            // Make notification pulse
            screenOffNotification.style.animation = 'pulse 1.5s infinite';
            
            // Auto-hide notification after 10 seconds
            if (screenOffTimeout) clearTimeout(screenOffTimeout);
            screenOffTimeout = setTimeout(hideWakeNotification, 10000);
        }
        
        // Hide wake notification
        function hideWakeNotification() {
            screenOffNotification.style.display = 'none';
            screenOffNotification.style.animation = '';
            notificationSound.pause();
            notificationSound.currentTime = 0;
        }
        
        // Wake screen function
        function wakeScreen() {
            screenOff = false;
            document.body.classList.remove('screen-off');
            screenOffBtn.innerHTML = '<i class="fas fa-power-off"></i>';
            screenOffBtn.title = 'Simulate Screen Off';
            hideWakeNotification();
        }
        
        // Fullscreen toggle
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                }
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
            }
        }
        
        // Update delay value display
        delayTime.addEventListener('input', function() {
            delayValue.textContent = this.value + 's';
        });
        
        // Update caller photo when selection changes
        callerPhotoSelect.addEventListener('change', function() {
            photoImg.src = this.value;
        });
        
        // Update caller name when input changes
        callerNameInput.addEventListener('input', function() {
            if (!callActive) {
                callerName.textContent = this.value || "Unknown Caller";
            }
        });
        
        // Schedule a fake call
        scheduleBtn.addEventListener('click', function() {
            // Reset any existing call
            resetCall();
            
            // Get the delay time
            const delay = parseInt(delayTime.value) * 1000;
            
            // Update UI to show scheduled info
            scheduleBtn.disabled = true;
            scheduleBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scheduling...';
            
            // Show scheduled info
            scheduledInfo.style.display = 'block';
            let countdownSeconds = parseInt(delayTime.value);
            countdown.textContent = countdownSeconds;
            
            // Start countdown
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                countdown.textContent = countdownSeconds;
                
                if (countdownSeconds <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            // Schedule the call
            scheduledTimeout = setTimeout(() => {
                startIncomingCall();
                scheduleBtn.disabled = false;
                scheduleBtn.innerHTML = '<i class="fas fa-play-circle"></i> Start Fake Call with Screen-Off Simulation';
                scheduledInfo.style.display = 'none';
                clearInterval(countdownInterval);
            }, delay);
        });
        
        // Start an incoming call
        function startIncomingCall() {
            callActive = true;
            
            // Update caller info from inputs
            callerName.textContent = callerNameInput.value || "Unknown Caller";
            photoImg.src = callerPhotoSelect.value;
            
            // Set call type
            const type = callType.value;
            let callTypeText = "Incoming call...";
            if (type === 'emergency') callTypeText = "EMERGENCY CALL";
            if (type === 'boss') callTypeText = "BOSS CALLING";
            if (type === 'friend') callTypeText = "BEST FRIEND";
            
            callStatus.textContent = callTypeText;
            
            // If screen off simulation is enabled and screen is off
            if (simulateScreenOffCheckbox.checked && screenOff) {
                // Show notification on "sleeping" screen
                notificationTitle.textContent = callTypeText;
                notificationBody.textContent = `${callerName.textContent} is calling...`;
                showWakeNotification();
            } else {
                // Otherwise show normal incoming call
                showIncomingCall();
            }
        }
        
        // Show incoming call UI
        function showIncomingCall() {
            callTimer.style.display = 'none';
            declineBtn.style.display = 'block';
            acceptBtn.style.display = 'block';
            endBtn.style.display = 'none';
            
            // Add ringing animation
            callerPhoto.classList.add('ringing-animation');
            
            // Play ringtone
            ringtoneAudio.play().catch(e => console.log("Audio play failed:", e));
            
            // Vibrate if supported
            if ("vibrate" in navigator) {
                navigator.vibrate([500, 500, 500, 500, 500, 500]);
            }
            
            // Reset call answered flag
            callAnswered = false;
        }
        
        // Accept the call
        acceptBtn.addEventListener('click', function() {
            if (!callActive) return;
            
            callAnswered = true;
            callStatus.textContent = "Connected";
            callTimer.style.display = 'block';
            declineBtn.style.display = 'none';
            acceptBtn.style.display = 'none';
            endBtn.style.display = 'block';
            
            // Remove ringing animation and stop ringtone
            callerPhoto.classList.remove('ringing-animation');
            ringtoneAudio.pause();
            ringtoneAudio.currentTime = 0;
            
            // Stop vibration if active
            if ("vibrate" in navigator) {
                navigator.vibrate(0);
            }
            
            // Hide notification if shown
            hideWakeNotification();
            
            // Play call connected sound
            callConnectedAudio.play().catch(e => console.log("Audio play failed:", e));
            
            // Start call timer
            seconds = 0;
            minutes = 0;
            updateCallTimer();
            callTimerInterval = setInterval(updateCallTimer, 1000);
        });
        
        // Decline the call
        declineBtn.addEventListener('click', function() {
            if (!callActive) return;
            
            callStatus.textContent = "Call declined";
            endCall();
        });
        
        // End the call
        endBtn.addEventListener('click', function() {
            if (!callActive) return;
            
            callStatus.textContent = callAnswered ? "Call ended" : "Missed call";
            endCall();
        });
        
        // End call function
        function endCall() {
            callActive = false;
            
            // Remove ringing animation
            callerPhoto.classList.remove('ringing-animation');
            
            // Stop any playing audio
            ringtoneAudio.pause();
            ringtoneAudio.currentTime = 0;
            notificationSound.pause();
            notificationSound.currentTime = 0;
            
            // Stop vibration if active
            if ("vibrate" in navigator) {
                navigator.vibrate(0);
            }
            
            // Hide notification if shown
            hideWakeNotification();
            
            // Play call ended sound
            callEndedAudio.play().catch(e => console.log("Audio play failed:", e));
            
            // Hide call buttons
            declineBtn.style.display = 'none';
            acceptBtn.style.display = 'none';
            endBtn.style.display = 'none';
            
            // Stop timer
            clearInterval(callTimerInterval);
            
            // Reset after 3 seconds
            setTimeout(resetCall, 3000);
        }
        
        // Reset call to initial state
        function resetCall() {
            callActive = false;
            callAnswered = false;
            
            // Clear any scheduled call
            if (scheduledTimeout) {
                clearTimeout(scheduledTimeout);
                scheduledTimeout = null;
            }
            
            // Clear countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // Reset UI
            callStatus.textContent = "Ready for fake call";
            callTimer.style.display = 'none';
            callerPhoto.classList.remove('ringing-animation');
            
            // Reset buttons
            declineBtn.style.display = 'block';
            acceptBtn.style.display = 'block';
            endBtn.style.display = 'none';
            
            // Reset schedule button
            scheduleBtn.disabled = false;
            scheduleBtn.innerHTML = '<i class="fas fa-play-circle"></i> Start Fake Call with Screen-Off Simulation';
            
            // Hide scheduled info
            scheduledInfo.style.display = 'none';
            
            // Stop any audio
            ringtoneAudio.pause();
            ringtoneAudio.currentTime = 0;
            notificationSound.pause();
            notificationSound.currentTime = 0;
            
            // Stop timer
            clearInterval(callTimerInterval);
        }
        
        // Update the call timer display
        function updateCallTimer() {
            seconds++;
            if (seconds >= 60) {
                minutes++;
                seconds = 0;
            }
            
            const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;
            const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;
            callTimer.textContent = `${formattedMinutes}:${formattedSeconds}`;
        }
        
        // Initialize the app
        function init() {
            // Set initial values
            delayValue.textContent = delayTime.value + 's';
            
            // Set up notification icon based on call type
            callType.addEventListener('change', function() {
                const icons = {
                    'normal': 'fa-phone-alt',
                    'emergency': 'fa-exclamation-triangle',
                    'boss': 'fa-user-tie',
                    'friend': 'fa-user-friends'
                };
                document.querySelector('.screen-off-notification-icon i').className = `fas ${icons[this.value]}`;
            });
            
            // Initial setup
            callType.dispatchEvent(new Event('change'));
        }
        
        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
